# Отчет по семестровому заданию

## Базовая часть
1. **Поднято СУБД и веб-сервер**
   - Установлена СУБД PostgreSQL версии 13.
   - Веб-сервер реализован с использованием Python 3.12, FastAPI и Uvicorn.

2. **Реализованы маршруты**
   - Настроены маршруты, взаимодействующие с базой данных.
   - Пример: создание пользователя через обращение к БД.

## Уязвимости и их исправления
1. **SQL-инъекция**
   - **Проблема**: В маршруте `/bad_create_user` уязвимость к SQL-инъекциям из-за прямой вставки входных параметров в запрос.
   - **Решение**: В маршруте `/good_create_user` применен параметризованный запрос и обработка входных данных для предотвращения инъекций.

2. **Избыточные подключения к БД в локальной сети**
   - **Проблема**: подмененные файлы `pg_hba.conf` и `postgresql.conf` не ограничивали подключения, что позволяло подключаться к БД из локальной сети. Порт открыт наружу через Docker Compose.
   - **Решение**: Изменить конфигурационные файлы `pg_hba.conf` и `postgresql.conf`, которые монтируются в Docker-контейнер либо оставить исходные от контейнера, ничего не монтируя. Ограничены подключения только из доверенных источников.

3. **Path Traversal**
   - **Проблема**: В маршруте `read_file` реализована уязвимость Path Traversal, позволяющая читать произвольные файлы (например, `/etc/shadow`, `/etc/passwd`).
   - **Решение**: Добавлена проверка входного параметра с использованием фиксированной директории (`allowed_files`), что ограничивает доступ только к разрешенным файлам.

4. **LFI (Local File Inclusion)**
   - **Проблема**: Реализована уязвимость LFI, схожая с Path Traversal, но с добавлением выполнения содержимого файла через `exec`. Это позволяет, например, запустить вредоносный скрипт, ранее загруженный на сервер.
   - **Решение**: Ограничение доступа к файлам через указание разрешенной директории, из которой можно считывать данные.

5. **Хранение учетных данных в исходном коде**
   - **Проблема**: В исходном коде присутствуют учетные данные от базы данных, что является потенциальной уязвимостью при загрузке кода в удаленные репозитории.
   - **Решение**: Рекомендуется вынести учетные данные в отдельный файл (например, `.env`, `.ini`, `.config`) и исключить его из системы контроля версий.

## Дополнительные задания
1. **Бэкап базы данных**
   - Реализован бэкап базы через отдельный Docker-контейнер.
   - В контейнере настроен скрипт, выполняющий резервное копирование данных.

2. **Мониторинг системы**
   - Настроена связка Prometheus и Grafana для мониторинга.
   - Реализована возможность просмотра статистики и регистрации событий, зафиксированных во время попыток эксплуатации уязвимостей.
